# Specification

# 1. Monitoring Components

## 1.1. Structured Application Logging
Implements the core logging strategy defined in REQ-REP-002. It uses the specified Serilog framework to capture structured diagnostic and operational logs from both the WPF Client and the background Windows Service. This is the foundation for all troubleshooting and auditing.

### 1.1.3. Type
LogAggregation

### 1.1.5. Provider
Serilog

### 1.1.6. Features

- Multi-sink writing to local rolling files and the Windows Event Log (REQ-REP-002).
- Automated masking of Protected Health Information (PHI) in all log outputs (REQ-REP-002, REQ-FNC-003).
- Configurable log rotation and retention policies to manage disk space (REQ-REP-002).
- Log enrichment with contextual properties like Correlation ID for tracing.
- Structured logging (JSON or similar) for easier parsing and analysis.

### 1.1.7. Configuration

- **File Sink Path:** %AppData%\Logs\
- **Event Log Source:** DICOM Management System
- **Minimum Log Level:** Information
- **Critical Error Log Level:** Error
- **Retention Days:** 30

## 1.2. Distributed Tracing via Correlation ID
A lightweight mechanism to fulfill the end-to-end tracing requirement of REQ-REP-002. A unique Correlation ID is generated by the client for each asynchronous operation and propagated through RabbitMQ message headers to the background service, enabling the linking of log entries for a single logical transaction across process boundaries.

### 1.2.3. Type
DistributedTracing

### 1.2.5. Provider
Custom Implementation

### 1.2.6. Features

- Generation of a unique ID per user-initiated asynchronous operation.
- Propagation of the ID via RabbitMQ message headers.
- Inclusion of the ID in all related log entries across the client and service.
- Enables filtering logs to reconstruct the full lifecycle of a print job or C-MOVE request.

### 1.2.7. Configuration

- **Propagation Header:** X-Correlation-ID
- **Id Generation:** System.Guid

## 1.3. System Health Probe Service
A dedicated component, likely an IHostedService within the Windows Service, that actively polls the health and status of critical system dependencies. This is the data source for the System Health Dashboard explicitly required by REQ-REP-002.

### 1.3.3. Type
ServiceHealthMonitoring

### 1.3.5. Provider
Custom IHostedService

### 1.3.6. Features

- Real-time status check of the Windows Service itself (via Named Pipes).
- Connectivity checks for the PostgreSQL database.
- Connectivity checks for the RabbitMQ message broker.
- Monitoring of RabbitMQ main queue depth and Dead-Letter Queue (DLQ) message count.
- Monitoring of available disk space for the configured DICOM storage path.

### 1.3.7. Configuration

- **Polling Interval Seconds:** 60
- **Disk Space Warning Threshold Percent:** 20
- **Disk Space Critical Threshold Percent:** 10

## 1.4. Critical Error Alerting
Fulfills the requirement for automated administrator notification (REQ-REP-002). This component triggers an email alert when the System Health Probe detects a metric crossing a critical threshold (e.g., low disk space, high DLQ count) or when a critical error is written to the Windows Event Log.

### 1.4.3. Type
Alerting

### 1.4.5. Provider
Custom Implementation

### 1.4.6. Features

- Triggering alerts based on health probe metrics crossing critical thresholds.
- Triggering alerts based on new 'Error' or 'Critical' level events in the Windows Event Log sink.
- Sends formatted email alerts to a configurable administrator email address.
- Utilizes the application's configured SMTP settings (FR-3.1.4).

### 1.4.7. Configuration

- **Admin Email Address:** Configurable via System Settings
- **Alert On Event Log Level:** Error
- **Alerting Cooldown Minutes:** 15



---

