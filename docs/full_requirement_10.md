[
  {
    "id": 64,
    "section": "3.1 DICOM Printing",
    "section_id": "REQ-FNC-001",
    "section_requirement_text": "FR-3.1.1: Windows Print Service Integration\nThe system shall provide a DICOM Print Service that integrates directly with the Windows Print API to enable printing on commercial inkjet/laser printers.\nThe application installer shall register and start a Windows Service named \"DICOM Print Service\".\nThe service shall automatically detect all system-installed printers.\nThe service shall fetch and display driver-supported resolutions for the selected printer.\n\n<<$Addition>> FR-3.1.1.1: Application-Service Communication\nEnhancement Justification: The original requirement specified a Windows Service but omitted how the user-facing application interacts with it. This addition defines the communication link and necessary error handling, ensuring a robust and user-friendly printing process.\nThe main desktop application shall communicate with the Windows Service via Named Pipes for Inter-Process Communication (IPC).\nThe application shall be able to submit a serialized print job object, containing image data, layout, and overlay information, to the service.\nThe application shall gracefully handle and notify the user with a non-blocking message if the Windows Service is stopped or unresponsive.\nThe \"Print\" button in the UI shall be disabled if the print service is not available.\n\nFR-3.1.2: Print Layout Configuration\nThe print preview UI shall provide predefined page templates: Single image (A4/A3), 2x2 grid (A4), and 1+3 comparison (A3).\nThe print preview UI shall provide modality-specific presets, such as 1x1 for X-ray and 4x4 for CT slices.\nUsers shall be able to customize page margins within a range of 5-20mm.\nUsers shall be able to select page orientation (Portrait/Landscape).\nUsers shall be able to select image scaling options: Fit-to-Page and Actual Size.\n\n<<$Addition>> FR-3.1.2.1: Configurable Auto-Arrangement\nEnhancement Justification: The term \"Auto-arrange\" is ambiguous. This addition provides the necessary functionality for administrators to define and customize these automated behaviors, making the feature adaptable to different clinical workflows.\nThe system shall support auto-arranging images on the print layout based on configurable rules.\nAn Admin user shall be able to configure the rules for auto-arrangement in the Settings Page.\nThe configuration shall allow mapping specific modalities to default layouts and defining the sorting order of images.\n\nFR-3.1.2.2: Manual Rearrangement\nUsers shall be able to manually rearrange images within the print preview grid via drag-and-drop.\n\nFR-3.1.3: Branding & De-identification Overlays\nUsers shall be able to upload a custom logo in PNG or JPEG format.\nThe logo position shall be configurable to Header, Footer, or custom X/Y coordinates.\nLogo scaling shall be adjustable from 10% to 50% of the page width.\nUsers shall be able to add custom text fields with configurable font, size, and color.\nCustom text fields shall support variables that are replaced at print time (e.g., `[PatientID]`, `[Date]`).\n\n<<$Change>> FR-3.1.3.1: Non-Destructive Templated Overlays\nEnhancement Justification: This clarifies a potential ambiguity. It specifies that overlays applied during printing are non-destructive, distinguishing this feature from the permanent pixel anonymization feature (FR-3.8.2). This prevents accidental modification of original medical data.\nThe system shall support non-destructive, print-time pixel-based overlay masks for de-identification.\nApplying a blackout overlay in the print preview shall not alter the original DICOM file on disk.\nThe system shall provide pre-built templates for de-identification (e.g., Chest X-Ray De-ID).\nOverlay templates shall support configurable rectangular and polygonal regions.\n\n<<$Addition>> FR-3.1.3.2: Overlay Template Management\nEnhancement Justification: The requirement for \"configurable regions\" implies the need for an editor. This addition explicitly defines the requirement for a template management UI, making the feature usable.\nThe system shall provide an interface for Admin users to manage overlay templates within the Settings Page.\nThe interface shall allow an Admin user to create new overlay templates by drawing and saving rectangular/polygonal regions.\nAdmin users shall be able to edit and delete existing templates.\n\nFR-3.1.4: Print Output Formats\nThe system shall send the configured print job to a selected Windows printer.\nThe application shall list and allow selection from all available Windows printers.\nThe final output from the physical printer shall match the print preview UI.\nThe system shall generate a PDF file of the print layout.\nThe generated PDF shall be PDF/A-3 compliant.\nThe system shall provide an option to embed DICOM metadata into the PDF file.\nThe system shall provide an option to password-protect the PDF using AES-256 encryption.\nThe system shall be able to attach the print output as a PDF or image(s) to an email.\nThe Settings Page shall provide fields to configure an SMTP server (host, port, credentials, TLS/STARTTLS).\nUsers shall be able to attach the output as a single PDF or as individual image files.\n<<$Change>> Exported images for email attachments shall be in a user-selectable format (JPEG/PNG).\nEnhancement Justification: The original requirement was ambiguous about the format of \"images\". This change specifies the supported formats and behavior for multi-image attachments, creating a clear and testable requirement.\nIf multiple images are selected for email attachment, they shall be attached as individual files.\nThe system shall allow the creation of pre-filled email templates with variables (e.g., `[PatientName]`, `[StudyDate]`).\n\n<<$Addition>> FR-3.1.4.4: Email Security Warning\nEnhancement Justification: This adds a critical security checkpoint to mitigate the risk of HIPAA violations by ensuring users are aware when they are about to transmit unsecured Protected Health Information.\nAs a business rule, if an email template is configured to include PHI variables or if an attached PDF is not password-protected, the system shall display a warning to the user about sending unsecured PHI before sending the email.\nWhen the \"Send\" button is clicked, the system shall check for PHI variables in the email body/subject and check if any PDF attachment is unencrypted.\nIf either condition is true, the system shall display a modal dialog with a warning message that requires explicit user confirmation to proceed.",
    "requirement_type": "functional",
    "priority": "",
    "original_text": "",
    "change_comments": false,
    "enhancement_justification": ""
  },
  {
    "id": 65,
    "section": "3.2 DICOM PACS Integration",
    "section_id": "REQ-FNC-002",
    "section_requirement_text": "FR-3.2.1: Storage & Retrieval\nThe application shall be able to act as a C-STORE SCP, listening on a configurable port for incoming studies.\nIncoming studies received via C-STORE shall be automatically routed to predefined local folders.\nThe application shall be able to act as a C-FIND and C-MOVE SCU.\nUsers shall be able to query a configured PACS by Study Date, Modality, or Patient ID.\nUsers shall be able to initiate a C-MOVE request to retrieve selected studies from the PACS to the local storage.\n\n<<$Addition>> FR-3.2.1.1: Routing Rule Configuration\nEnhancement Justification: The \"Auto-routing\" feature lacks definition. This addition specifies that the rules governing this routing must be user-configurable, making the feature flexible and adaptable to various network environments.\nThe criteria for auto-routing incoming studies shall be configurable by an Admin user.\nThe Settings Page shall provide a UI for creating routing rules.\nA routing rule shall be definable based on criteria such as the sending AE Title, Modality, or other specified DICOM tags.\nEach rule shall specify a destination folder path.\n\nFR-3.2.2: PACS Configuration\n<<$Change>> Admin users shall add, remove, and edit PACS server configurations via the application's Settings Page.\nEnhancement Justification: This resolves a contradiction between the original requirement for a \"JSON configuration file\" and the expectation of a user-friendly \"Settings Page\" (FR-3.7). Centralizing configuration in the UI improves usability and reduces errors associated with manual file editing, providing a consistent user experience.\nConfiguration of PACS servers via an external JSON file shall be disallowed.\nThe Settings Page shall contain a section for PACS management, accessible only to Admins.\nThe UI shall allow configuration of AE Title, IP Address, Port, and capabilities (C-STORE, C-FIND, C-MOVE) for each PACS.\nThe UI shall provide a \"Verify\" button that performs a C-ECHO test to the selected PACS configuration.",
    "requirement_type": "functional",
    "priority": "",
    "original_text": "",
    "change_comments": false,
    "enhancement_justification": ""
  },
  {
    "id": 66,
    "section": "3.3 DICOM Security",
    "section_id": "REQ-FNC-003",
    "section_requirement_text": "FR-3.3.1: Data Protection\nThe local SQLite database file shall be encrypted using AES-256.\nApplication logs shall be written to a local file and the Windows Event Log.\nAny PHI (e.g., Patient Name, Patient ID) written to logs shall be masked (e.g., \"PatientName: ******\").\n\nFR-3.3.2: Access Control\nThe application shall require user login for access.\nUI elements and features shall be enabled or disabled based on the logged-in user's role as defined in the permissions matrix (Section 2.3.2).\n\n<<$Addition>> FR-3.3.2.1: Session Timeout Behavior\nEnhancement Justification: The term \"session timeout\" is ambiguous for a desktop application. This clarifies the exact behavior (lock screen, password re-entry), ensuring the security requirement is implemented effectively without data loss.\nThe application session shall automatically lock after 15 minutes of no keyboard or mouse input.\nWhen the session locks, the application shall display a lock screen overlay.\nThe current application state, including open images, shall be preserved behind the lock screen.\nThe user shall be required to re-enter their password to unlock the session and resume activity.",
    "requirement_type": "functional",
    "priority": "",
    "original_text": "",
    "change_comments": false,
    "enhancement_justification": ""
  },
  {
    "id": 62,
    "section": "3.4 DICOM Metadata Viewing/Editing",
    "section_id": "REQ-FNC-004",
    "section_requirement_text": "Enhancement Justification: To support the new non-destructive editing workflow defined in REQ-NFR-003, the audit trail must capture all state-changing actions related to file modifications. This requirement is enhanced to explicitly include the logging of 'Working Copy Created', 'Working Copy Modified', and 'Working Copy Discarded' events.\n\n--- Original Text ---\nFR-3.4.1: Metadata Viewer\nThe application shall provide a dedicated panel to display the metadata of the selected image or series.\nMetadata shall be grouped by category: Patient, Study, Series, and Equipment.\nThe metadata viewer shall include a search bar to allow filtering metadata for specific tags by name or tag number (e.g., (0010,0010)).\n\nFR-3.4.2: Metadata Editing\nOnly users with the Admin role shall be able to enter edit mode for metadata.\nBy default, only non-critical tags like Series Description (0008,103E) shall be editable.\n\n<<$Addition>> FR-3.4.2.1: Configurable Editable Tags\nEnhancement Justification: Hard-coding the list of editable tags is inflexible. This addition allows administrators to customize data governance policies according to their institution's needs.\nThe list of DICOM tags that are editable shall be configurable by an Admin user.\nThe Settings Page shall include a UI for Admins to add or remove DICOM tags from an \"editable\" list.\n\nFR-3.4.2.2: Audit Trail for Modifications\nAll modifications to DICOM metadata shall be recorded in an audit trail.\nEvery change to a DICOM tag shall be logged with the user's ID, a timestamp, the original value, and the new value.\n\n<<$Addition>> FR-3.4.2.3: Audit Trail Viewer\nEnhancement Justification: An audit trail is useless without a way to view or export it. This addition provides the necessary UI for administrators to perform security and data integrity audits.\nThe system shall provide an interface for Admin users to review and export the audit trail.\nAn \"Audit Trail\" section in the Settings Page shall display the modification logs in a readable format.\nThe audit trail viewer shall support filtering by user and date range.\nThe audit trail viewer shall provide an \"Export to CSV\" button to save the filtered log data.\n\n--- Enhanced Specification ---\nFR-3.4.1: Metadata Viewer\nThe application shall provide a dedicated panel to display the metadata of the selected image or series.\nMetadata shall be grouped by category: Patient, Study, Series, and Equipment.\nThe metadata viewer shall include a search bar to allow filtering metadata for specific tags by name or tag number (e.g., (0010,0010)).\n\nFR-3.4.2: Metadata Editing\nOnly users with the Admin role shall be able to enter edit mode for metadata.\nBy default, only non-critical tags like Series Description (0008,103E) shall be editable.\n\n<<$Addition>> FR-3.4.2.1: Configurable Editable Tags\nEnhancement Justification: Hard-coding the list of editable tags is inflexible. This addition allows administrators to customize data governance policies according to their institution's needs.\nThe list of DICOM tags that are editable shall be configurable by an Admin user.\nThe Settings Page shall include a UI for Admins to add or remove DICOM tags from an \"editable\" list.\n\nFR-3.4.2.2: Audit Trail for Modifications\nAll modifications to DICOM metadata and file state shall be recorded in an audit trail.\nEvery change to a DICOM tag shall be logged with the user's ID, a timestamp, the original value, and the new value.\nThe audit trail shall also log file state change events, including 'Working Copy Created', 'Working Copy Modifications Saved', and 'Working Copy Discarded', with the user's ID and a timestamp.\n\n<<$Addition>> FR-3.4.2.3: Audit Trail Viewer\nEnhancement Justification: An audit trail is useless without a way to view or export it. This addition provides the necessary UI for administrators to perform security and data integrity audits.\nThe system shall provide an interface for Admin users to review and export the audit trail.\nAn \"Audit Trail\" section in the Settings Page shall display the modification logs in a readable format.\nThe audit trail viewer shall support filtering by user and date range.\nThe audit trail viewer shall provide an \"Export to CSV\" button to save the filtered log data.",
    "requirement_type": "functional",
    "priority": "",
    "original_text": "",
    "change_comments": false,
    "enhancement_justification": ""
  },
  {
    "id": 67,
    "section": "3.5 DICOM Image Viewing",
    "section_id": "REQ-FNC-005",
    "section_requirement_text": "FR-3.5.1: Image Rendering\nThe application shall provide a basic DICOM viewer.\nThe viewer shall be able to render both monochrome and color DICOM images.\nThe viewer shall support multi-frame series (e.g., CT/MRI/US), allowing users to scroll through frames.\nThe viewer shall correctly apply modality-specific rendering protocols, such as default windowing for CT and inversion for X-rays.\nThe viewer shall display overlay annotations and embedded measurements from the DICOM file.\nThe viewer shall support GPU-accelerated rendering using DirectX.\n\nFR-3.5.2: Viewer UI Requirements\nThe viewer UI shall provide a side-by-side comparison mode.\nWhen in comparison mode, scroll and zoom actions shall be synchronizable between the two viewports.\nThe viewer UI shall display a thumbnail grid for easy navigation within a series.",
    "requirement_type": "functional",
    "priority": "",
    "original_text": "",
    "change_comments": false,
    "enhancement_justification": ""
  },
  {
    "id": 55,
    "section": "3.6 DICOM File Management",
    "section_id": "REQ-FNC-006",
    "section_requirement_text": "Enhancement Justification: User requested the ability to specify and test the accessibility of the DICOM storage location. Enhanced requirement to include a new sub-requirement (FR-3.6.2.1) for a configurable storage path with a 'Test' button to verify write/delete permissions, ensuring system reliability and preventing runtime I/O errors.\n\n--- Original Text ---\nFR-3.6.1: Import/Export\nUsers shall be able to import DICOM files by dragging and dropping them from local folders, CDs, USB drives, or network shares onto the application window.\nUsers shall be able to export selected images or series to non-DICOM formats (JPEG/PNG) with configurable resolution.\n\n<<$Addition>> FR-3.6.1.1: Import Conflict Handling\nEnhancement Justification: This addresses a common data conflict scenario. Providing clear options for handling duplicate UIDs prevents accidental data loss and ensures data integrity within the local storage.\nThe system shall handle cases where an imported study's UID already exists in the local database.\nUpon detecting a duplicate Study Instance UID during import, the system shall prompt the user with a dialog.\nThe dialog shall provide three options: \"Overwrite\" the existing study, \"Discard\" the import, or \"Save as New\" (which generates a new UID for the imported study).\n\nFR-3.6.2: Organization and Validation\nLocal storage of DICOM files shall follow a hierarchical structure: `[StoragePath]\\[PatientID]\\[StudyUID]\\[SeriesUID]`.\nThe UI shall support tag-based search by Patient Name, Study Date, and Modality.\nDuring import, the system shall verify DICOM compliance (e.g., valid header, required tags) and reject non-compliant files.\n\n--- Enhanced Specification ---\nFR-3.6.1: Import/Export\nUsers shall be able to import DICOM files by dragging and dropping them from local folders, CDs, USB drives, or network shares onto the application window.\nUsers shall be able to export selected images or series to non-DICOM formats (JPEG/PNG) with configurable resolution.\n\n<<$Addition>> FR-3.6.1.1: Import Conflict Handling\nEnhancement Justification: This addresses a common data conflict scenario. Providing clear options for handling duplicate UIDs prevents accidental data loss and ensures data integrity within the local storage.\nThe system shall handle cases where an imported study's UID already exists in the local database.\nUpon detecting a duplicate Study Instance UID during import, the system shall prompt the user with a dialog.\nThe dialog shall provide three options: \"Overwrite\" the existing study, \"Discard\" the import, or \"Save as New\" (which generates a new UID for the imported study).\n\nFR-3.6.2: Organization and Validation\nLocal storage of DICOM files shall follow a hierarchical structure: `[StoragePath]\\[PatientID]\\[StudyUID]\\[SeriesUID]`.\nThe UI shall support tag-based search by Patient Name, Study Date, and Modality.\nDuring import, the system shall verify DICOM compliance (e.g., valid header, required tags) and reject non-compliant files.\n\nFR-3.6.2.1: Storage Location Verification\nAn Admin user shall be able to specify any Windows-accessible storage location (local path, UNC path) for DICOM files via the Settings Page.\nThe Settings Page shall provide a \"Test\" button next to the storage path input field.\nUpon clicking the \"Test\" button, the system shall attempt to write a temporary file with a unique random name to the specified path, verify its creation, and then delete it.\nThe system shall provide immediate feedback to the user indicating whether the location is accessible and writable.",
    "requirement_type": "functional",
    "priority": "",
    "original_text": "",
    "change_comments": false,
    "enhancement_justification": ""
  },
  {
    "id": 68,
    "section": "3.7 DICOM Data Manipulation & Workflow",
    "section_id": "REQ-FNC-007",
    "section_requirement_text": "FR-3.7.1: Basic Tools\nThe viewer shall provide a zoom functionality supporting a range from 10% to 800%.\nThe viewer shall provide rotation functionality in 90-degree increments and free rotation (0-360 degrees).\nThe viewer shall provide Pan and Flip (horizontal/vertical) tools.\nThe viewer shall provide Window Level (WW/WL) adjustment that can be controlled interactively.\nThe viewer shall provide WW/WL presets (e.g., Lung, Bone).\n\nFR-3.7.2: Annotations and Measurements\nThe system shall support creating non-destructive annotations and measurements.\nUsers shall be able to draw arrows, add text, and define Regions of Interest (ROI).\nThe system shall provide measurement tools for length, angle, and area.\nMeasurements shall display units (mm/cm) derived from the DICOM metadata.\nAll annotations and measurements shall be saved as separate DICOM Grayscale Softcopy Presentation State (GSPS) objects, linked to the original series.\n\nFR-3.7.3: Hanging Protocols\nThe system shall support customizable display layouts (hanging protocols).\nUsers shall be able to define and save custom layouts (e.g., 2x2, 1+3) on a per-user basis.\n\n<<$Addition>> FR-3.7.3.1: Hanging Protocol Activation\nEnhancement Justification: This clarifies how hanging protocols are activated, defining both automated, intelligent application and manual override, which is crucial for workflow efficiency.\nHanging protocols shall be triggerable automatically or selectable manually.\nAn Admin shall be able to configure rules to automatically apply a hanging protocol when a study is opened, based on matching Modality and Body Part Examined tags.\nA user shall be able to manually select a saved hanging protocol from a dropdown list in the viewer.\n\nFR-3.7.4: Keyboard Shortcuts\nThe application shall support keyboard shortcuts for common actions.\nThe application shall use `Ctrl+P` to open the Print Preview window.\nThe application shall use `Ctrl+W` to activate the Window Level (WW/WL) tool.\nOther common actions such as Zoom and Pan shall have corresponding keyboard shortcuts.",
    "requirement_type": "functional",
    "priority": "",
    "original_text": "",
    "change_comments": false,
    "enhancement_justification": ""
  },
  {
    "id": 69,
    "section": "3.8 Anonymization",
    "section_id": "REQ-FNC-008",
    "section_requirement_text": "FR-3.8.1: DICOM Metadata Anonymization\nThe system shall provide tools to remove or replace PHI from DICOM metadata.\nA manual mode shall allow users to select specific tags to anonymize.\nThe system shall provide preset profiles: \"Basic De-ID\" (removes ~10 critical tags) and \"Full De-ID\" (removes 30+ tags as per HIPAA Safe Harbor).\nThe system shall provide a pseudonymization option to replace the original Patient ID with a hashed or randomized ID, with a configurable algorithm.\nAnonymization actions shall create new DICOM files, leaving the original files untouched.\n\nFR-3.8.2: Pixel Anonymization\n<<$Change>> The system shall allow users to apply permanent, destructive overlays of shapes or text on image pixels to mask identifiers.\nEnhancement Justification: This clarifies the distinction between this feature and the non-destructive print-time overlays (FR-3.1.3.1). Specifying that this action is permanent and creates new files is critical for data integrity and user understanding.\nThis action shall create a new, anonymized DICOM series and shall not modify the original file.\nA UI shall be provided to draw blackout shapes or burn text into the image pixel data.\nExecuting the pixel anonymization shall save a new set of DICOM files with the modifications.\nThe original DICOM files shall be preserved without modification.\nUsers shall be able to save pixel anonymization templates as JSON files for reuse.",
    "requirement_type": "functional",
    "priority": "",
    "original_text": "",
    "change_comments": false,
    "enhancement_justification": ""
  },
  {
    "id": 70,
    "section": "3.9 System Settings and Configuration",
    "section_id": "REQ-FNC-009",
    "section_requirement_text": "FR-3.9.1: Settings Page\nA centralized Settings Page shall be available for application configuration.\n<<$Change>> The Settings Page shall be located under a main \"Administration\" tab/area.\nEnhancement Justification: This clarifies the location and access control for the settings page, aligning with the role-based security model.\nAccess to the Administration area shall be restricted to users with the Admin role.\n\nFR-3.9.2: System Configuration\nAdmins shall be able to configure system-level settings.\nAdmins shall be able to set the default storage path for incoming DICOM studies.\nAdmins shall be able to configure auto-purge rules (e.g., delete studies older than 365 days).\nAdmins shall be able to configure network proxy settings for DICOM and web communication.\n\n<<$Addition>> FR-3.9.2.1: User Management\nEnhancement Justification: This fills a critical gap. A system with role-based access control requires a mechanism for managing user accounts.\nA UI shall be provided for Admins to manage user accounts.\nAdmins shall be able to create new user accounts, specifying a username, password, and role.\nAdmins shall be able to edit existing users, including resetting passwords and changing roles.\nAdmins shall be able to delete user accounts.\n\nFR-3.9.3: User Preferences\nIndividual users shall be able to customize their experience.\nUsers shall be able to customize their default annotation colors.\nUsers shall be able to create and save their own default windowing presets.",
    "requirement_type": "functional",
    "priority": "",
    "original_text": "",
    "change_comments": false,
    "enhancement_justification": ""
  },
  {
    "id": 71,
    "section": "4.1 User Interfaces",
    "section_id": "REQ-INT-001",
    "section_requirement_text": "The UI shall be clean, modern, and intuitive, following standard Windows application design conventions.\n<<$Change>> The main application window shall be organized into four primary areas/tabs: Incoming/Print Queue, Local Storage, Query/Retrieve, and Administration.\nEnhancement Justification: The original three-tab layout omitted a place for critical administrative functions. Adding a dedicated \"Administration\" area provides a logical home for settings, user management, and audit trails, improving UI organization.\nA toggle switch shall be available for users to switch between a Dark and Light theme.\nThe application shall provide a high-contrast mode to comply with WCAG 2.1 AA for low-vision users.\nThe application shall be primarily controlled via keyboard and mouse.",
    "requirement_type": "interface",
    "priority": "",
    "original_text": "",
    "change_comments": false,
    "enhancement_justification": ""
  },
  {
    "id": 72,
    "section": "4.2 Hardware Interfaces",
    "section_id": "REQ-INT-002",
    "section_requirement_text": "The application shall interface with any Windows 10/11-supported inkjet or laser printer via the standard Windows Print API (GDI+).\nThe application shall not require direct hardware communication.",
    "requirement_type": "interface",
    "priority": "",
    "original_text": "",
    "change_comments": false,
    "enhancement_justification": ""
  },
  {
    "id": 73,
    "section": "4.3 Software Interfaces",
    "section_id": "REQ-INT-003",
    "section_requirement_text": "The application shall use the `fo-dicom` library for all DICOM-related operations.\nThe application shall interface with a local SQLite database via `Microsoft.Data.Sqlite` with SQLCipher support.\nThe database shall be managed by Entity Framework Core 6+.\nThe application shall communicate with the Odoo web portal's REST API over HTTPS for license validation.\nThe application shall use the native WPF renderer (DirectX-based) for standard UI.\nThe application shall use `Vortice.Windows` (DirectX 11/12 wrapper) for high-performance rendering of large DICOM images.",
    "requirement_type": "interface",
    "priority": "",
    "original_text": "",
    "change_comments": false,
    "enhancement_justification": ""
  },
  {
    "id": 74,
    "section": "4.4 Communication Interfaces",
    "section_id": "REQ-INT-004",
    "section_requirement_text": "The application shall support DICOM network communication over TCP/IP.\nThe application shall support configurable AE Titles, ports, and transfer syntaxes (e.g., JPEG Lossless, RLE).\nThe application shall support DICOM TLS if configured.\nAll communication with the Odoo licensing API shall use HTTPS over TLS 1.2+.\nThe application shall use SMTP to send emails, with support for STARTTLS encryption.",
    "requirement_type": "interface",
    "priority": "",
    "original_text": "",
    "change_comments": false,
    "enhancement_justification": ""
  },
  {
    "id": 63,
    "section": "5.0 Non-Functional Requirements",
    "section_id": "REQ-NFR-001",
    "section_requirement_text": "Enhancement Justification: The architectural shift to include PostgreSQL and RabbitMQ (REQ-TEC-001) introduces new external dependencies. This requirement is enhanced to include these services in the system requirements and to mandate that the application installer must check for their presence and guide the user in configuration, filling a critical deployment gap.\n\n--- Original Text ---\nThe application shall operate on Windows 10 (Version 20H2 or later) or Windows 11.\nThe system shall require a minimum hardware configuration of an x64-based, 2 GHz or faster processor.\nThe system shall require a minimum of 8 GB of RAM; 16 GB is recommended.\nThe system shall require 500 MB of hard drive space for installation, with additional space required for local DICOM storage.\nThe system shall recommend a Solid State Drive (SSD) for optimal performance.\nThe system shall require a minimum display resolution of 1920x1080.\nThe system shall require a DirectX 11 compatible graphics card for GPU-accelerated rendering.\nThe application installer shall include the .NET 6+ Desktop Runtime dependency.\n\n--- Enhanced Specification ---\nThe application shall operate on Windows 10 (Version 20H2 or later) or Windows 11.\nThe system shall require a minimum hardware configuration of an x64-based, 2 GHz or faster processor.\nThe system shall require a minimum of 8 GB of RAM; 16 GB is recommended.\nThe system shall require 500 MB of hard drive space for installation, with additional space required for local DICOM storage.\nThe system shall recommend a Solid State Drive (SSD) for optimal performance.\nThe system shall require a minimum display resolution of 1920x1080.\nThe system shall require a DirectX 11 compatible graphics card for GPU-accelerated rendering.\nThe system requires network access to a configured PostgreSQL server (version 13+) and a RabbitMQ server instance.\nThe application installer shall include the .NET 6+ Desktop Runtime dependency.\nThe installer shall perform prerequisite checks for connectivity to the required PostgreSQL and RabbitMQ services and shall prevent installation from completing if connectivity cannot be established with user-provided connection details.",
    "requirement_type": "non_functional",
    "priority": "",
    "original_text": "",
    "change_comments": false,
    "enhancement_justification": ""
  },
  {
    "id": 56,
    "section": "5.1 Performance Requirements",
    "section_id": "REQ-NFR-002",
    "section_requirement_text": "Enhancement Justification: User requested a more robust handling mechanism for long-running tasks like PDF generation and printing. Enhanced requirement to specify the use of a message queue (e.g., RabbitMQ) for these tasks. This change decouples these processes from the main application, improves scalability, and ensures guaranteed, queued processing even under heavy load.\n\n--- Original Text ---\nThe application shall launch in under 5 seconds on an HDD.\nThe application shall launch in under 3 seconds on an SSD.\n<<$Change>> The system shall load DICOM images up to 500MB in size within 3 seconds on standard hardware.\n<<$Change>> For images exceeding 500MB (up to 2GB), the system shall initiate display of the first available frame or a low-resolution preview within 5 seconds.\n<<$Change>> For images exceeding 500MB, full data loading and rendering shall complete progressively in a background thread.\nEnhancement Justification: The original requirement of \"Load images _2GB in size within _3 seconds on standard hardware\" was deemed infeasible. The revised requirement sets a realistic performance target for common large studies and provides a progressive loading strategy for exceptionally large files, ensuring a responsive user experience.\nThe application shall handle at least 10 simultaneous C-STORE operations without significant degradation in UI responsiveness.\nPDF generation time shall be under 10 seconds for a 50-page document (A4, 300dpi).\nAll long-running tasks (file I/O, network requests, PDF generation) shall be executed asynchronously using `async/await` to keep the UI responsive at all times.\n\n--- Enhanced Specification ---\nThe application shall launch in under 5 seconds on an HDD.\nThe application shall launch in under 3 seconds on an SSD.\n<<$Change>> The system shall load DICOM images up to 500MB in size within 3 seconds on standard hardware.\n<<$Change>> For images exceeding 500MB (up to 2GB), the system shall initiate display of the first available frame or a low-resolution preview within 5 seconds.\n<<$Change>> For images exceeding 500MB, full data loading and rendering shall complete progressively in a background thread.\nEnhancement Justification: The original requirement of \"Load images _2GB in size within _3 seconds on standard hardware\" was deemed infeasible. The revised requirement sets a realistic performance target for common large studies and provides a progressive loading strategy for exceptionally large files, ensuring a responsive user experience.\nThe application shall handle at least 10 simultaneous C-STORE operations without significant degradation in UI responsiveness.\nPDF generation for a 50-page document (A4, 300dpi) shall be submitted to a background processing queue in under 2 seconds. The generation itself shall be handled by a message queue system (e.g., RabbitMQ) to ensure guaranteed and batched processing.\nPhysical printing jobs shall be submitted to a background processing queue managed by a message queue system (e.g., RabbitMQ) to ensure reliable, sequential processing.\nAll other long-running tasks (file I/O, network requests) shall be executed asynchronously using `async/await` to keep the UI responsive at all times.",
    "requirement_type": "non_functional",
    "priority": "",
    "original_text": "",
    "change_comments": false,
    "enhancement_justification": ""
  },
  {
    "id": 57,
    "section": "5.2 Safety Requirements",
    "section_id": "REQ-NFR-003",
    "section_requirement_text": "Enhancement Justification: User provided detailed clarification on the file modification workflow. Enhanced requirement to specify the state management for DICOM files, detailing the creation of a single working copy, the ability to save or discard changes, and the requirement to log these state-change actions in the audit trail. This ensures data integrity and provides a clear, non-destructive editing process.\n\n--- Original Text ---\nThe system shall ensure that original DICOM files are never modified by viewing, printing, or annotation operations.\nModification actions, including metadata editing and anonymization, shall create new files.\n\n--- Enhanced Specification ---\nThe system shall ensure that original DICOM files are never modified by viewing, printing, or annotation operations.\nModification actions, including metadata editing and anonymization, shall create a working copy of the original files, leaving the original files untouched.\nThere shall be only one 'original' version and one 'modified' (working copy) version of a study at any time; multiple versioning is not required.\nA user can perform subsequent modifications on the existing working copy, overwriting it upon saving.\nA user shall have the option to discard all modifications, which will delete the working copy and revert the view to the original files.\nThe system shall maintain a clear state indicator in the UI to show whether the user is viewing the original or modified version.\nAll state-changing actions on the working copy (creation, saving modifications, discarding modifications) shall be recorded in the audit trail, logging the user, timestamp, and action performed.",
    "requirement_type": "non_functional",
    "priority": "",
    "original_text": "",
    "change_comments": false,
    "enhancement_justification": ""
  },
  {
    "id": 60,
    "section": "5.3 Security Requirements",
    "section_id": "REQ-NFR-004",
    "section_requirement_text": "Enhancement Justification: The change to PostgreSQL (REQ-TEC-001) made the previous SQLite-specific file encryption requirements obsolete. This requirement is enhanced to specify appropriate security measures for a client-server RDBMS, including transport layer security for connections and strategies for data-at-rest encryption.\n\n--- Original Text ---\nUser identity shall be managed locally.\nUser passwords shall be stored in the database using a strong, salted hashing algorithm (BCrypt).\nA role-based access control (RBAC) model shall be strictly enforced as per the permissions matrix in Section 2.3.2.\nThe local SQLite database file shall be encrypted using SQLCipher with AES-256.\nThe database encryption key shall be protected using the Windows DPAPI.\nCommunication with the Odoo licensing API shall use TLS 1.2+.\nSMTP communication shall be configured to use STARTTLS.\nDICOM communication shall support DICOM TLS.\nThe \"Full De-ID\" anonymization profile shall ensure that outputs meet the criteria for HIPAA Safe Harbor.\n<<$Change>> The application shall be developed following secure coding best practices to prevent common vulnerabilities in desktop applications.\nEnhancement Justification: The \"OWASP Top 10\" is primarily for web applications. This requirement is rephrased to be more specific and relevant to a desktop application's security context, making it more actionable and testable.\nSecure coding practices shall include but not be limited to input validation to prevent injection attacks, secure handling of credentials, and prevention of buffer overflows.\n\n--- Enhanced Specification ---\nUser identity shall be managed locally.\nUser passwords shall be stored in the database using a strong, salted hashing algorithm (BCrypt).\nA role-based access control (RBAC) model shall be strictly enforced as per the permissions matrix in Section 2.3.2.\nAll network connections from the application to the PostgreSQL database server shall be encrypted using TLS.\nData at rest within the PostgreSQL database shall be encrypted using Transparent Data Encryption (TDE) or equivalent column-level encryption mechanisms.\nDatabase credentials shall be stored securely using the Windows Credential Manager and not in plaintext configuration files.\nCommunication with the Odoo licensing API shall use TLS 1.2+.\nSMTP communication shall be configured to use STARTTLS.\nDICOM communication shall support DICOM TLS.\nThe \"Full De-ID\" anonymization profile shall ensure that outputs meet the criteria for HIPAA Safe Harbor.\n<<$Change>> The application shall be developed following secure coding best practices to prevent common vulnerabilities in desktop applications.\nEnhancement Justification: The \"OWASP Top 10\" is primarily for web applications. This requirement is rephrased to be more specific and relevant to a desktop application's security context, making it more actionable and testable.\nSecure coding practices shall include but not be limited to input validation to prevent injection attacks, secure handling of credentials, and prevention of buffer overflows.",
    "requirement_type": "non_functional",
    "priority": "",
    "original_text": "",
    "change_comments": false,
    "enhancement_justification": ""
  },
  {
    "id": 75,
    "section": "5.4 Software Quality Attributes",
    "section_id": "REQ-NFR-005",
    "section_requirement_text": "The application shall handle network and service interruptions gracefully, such as PACS connection loss or a stopped print service.\nGenerated PDFs shall be viewable in Adobe Acrobat Reader 9+ and other common PDF viewers.\nThe application shall be developed using a modular architecture (Modular Monolith) to separate concerns (UI, Core Logic, Data Access).\nThe MVVM design pattern shall be used in the WPF application.\nThe application UI shall support English (default) and Spanish for UI text in Phase 1.",
    "requirement_type": "non_functional",
    "priority": "",
    "original_text": "",
    "change_comments": false,
    "enhancement_justification": ""
  },
  {
    "id": 76,
    "section": "7.1 Reports",
    "section_id": "REQ-REP-001",
    "section_requirement_text": "The application shall provide a feature for Admin users to export the metadata modification audit trail as a CSV file.",
    "requirement_type": "reports_alerts",
    "priority": "",
    "original_text": "",
    "change_comments": false,
    "enhancement_justification": ""
  },
  {
    "id": 77,
    "section": "7.2 Monitoring & Logging",
    "section_id": "REQ-REP-002",
    "section_requirement_text": "The Serilog logging framework shall be configured to write to two destinations (sinks).\nLogs shall be written to a local rolling text file stored in the user's `AppData\\Logs` directory.\nAll PHI in local text file logs shall be masked.\nLogs for critical errors and security-related events shall be written to the Windows Event Log.\nLogs shall include timestamps, severity levels, and detailed context for events such as DICOM network operations, file I/O, and application errors.",
    "requirement_type": "reports_alerts",
    "priority": "",
    "original_text": "",
    "change_comments": false,
    "enhancement_justification": ""
  },
  {
    "id": 58,
    "section": "2.5 Design and Implementation Constraints",
    "section_id": "REQ-TEC-001",
    "section_requirement_text": "Enhancement Justification: User requested a change in the database technology from SQLite to PostgreSQL to better handle high-volume data insertion. The user also suggested RabbitMQ for guaranteed record insertion. Enhanced requirement to specify PostgreSQL as the local data store and to incorporate a message queue for decoupling network reception from database writing, improving system robustness and performance under load.\n\n--- Original Text ---\nThe application shall be developed using the .NET 6+ framework, C# programming language, and Windows Presentation Foundation (WPF).\nThe application shall use the `fo-dicom` library for all DICOM operations.\nThe application shall use SQLite for the local data store.\nThe application shall integrate with the existing Odoo Web Portal APIs for license validation.\nThe application shall be developed with HIPAA compliance considerations for PHI handling, anonymization, and security.\n\n--- Enhanced Specification ---\nThe application shall be developed using the .NET 6+ framework, C# programming language, and Windows Presentation Foundation (WPF).\nThe application shall use the `fo-dicom` library for all DICOM operations.\nThe application shall use PostgreSQL for the local data store to handle high-volume record insertion from modalities with large numbers of images per study.\nTo ensure guaranteed and high-throughput data insertion, the C-STORE SCP service shall publish received study metadata to a message queue (e.g., RabbitMQ), which will be consumed by a separate process responsible for database writing.\nThe application shall integrate with the existing Odoo Web Portal APIs for license validation.\nThe application shall be developed with HIPAA compliance considerations for PHI handling, anonymization, and security.",
    "requirement_type": "technology",
    "priority": "",
    "original_text": "",
    "change_comments": false,
    "enhancement_justification": ""
  },
  {
    "id": 61,
    "section": "2.6 System Architecture",
    "section_id": "REQ-TEC-002",
    "section_requirement_text": "Enhancement Justification: The introduction of a message queue (REQ-NFR-002, REQ-TEC-001) for multiple background tasks (printing, PDF generation, database writes) expands the role of the background service. This requirement is enhanced to accurately describe the architecture, where the service acts as a consumer for various asynchronous jobs, not just print management.\n\n--- Original Text ---\nThe system shall be architected as a Modular Monolith with a Background Service.\nThe system shall be composed of a main WPF desktop application for user interaction and a separate background Windows Service for print queue management.\nCommunication between the main application and the background service shall be handled via Named Pipes.\n\n--- Enhanced Specification ---\nThe system shall be architected as a Modular Monolith with a decoupled Background Worker Service.\nThe system shall be composed of a main WPF desktop application for user interaction and a separate background Windows Service that acts as a consumer for a message queue.\nThe background service shall be responsible for processing asynchronous, long-running tasks, including but not limited to database writes from C-STORE operations, PDF generation, and physical print job spooling.\nCommunication between the main application (producer) and the background service (consumer) shall be handled via a message queue (e.g., RabbitMQ).\nDirect communication for immediate tasks, such as submitting a print job to the Windows Print API, shall still utilize Named Pipes between the main application and the DICOM Print Service.",
    "requirement_type": "technology",
    "priority": "",
    "original_text": "",
    "change_comments": false,
    "enhancement_justification": ""
  },
  {
    "id": 59,
    "section": "2.7 Technology Stack",
    "section_id": "REQ-TEC-003",
    "section_requirement_text": "Enhancement Justification: This requirement was updated for consistency with REQ-TEC-001, which changed the core database from SQLite to PostgreSQL and introduced RabbitMQ for message queuing. The technology stack must accurately reflect all core system components.\n\n--- Original Text ---\nThe application shall be built on the .NET 6+ Framework.\nThe application shall be written in C# 10+.\nThe desktop UI shall be built with WPF (Windows Presentation Foundation).\nThe UI shall use the MVVM (Model-View-ViewModel) design pattern.\nThe Windows Service shall be built using Microsoft.Extensions.Hosting.WindowsServices.\nInter-Process Communication shall use Named Pipes.\nThe database shall be SQLite with SQLCipher for AES-256 encryption.\nThe ORM shall be Entity Framework Core 6+.\nThe DICOM library shall be fo-dicom.\nGraphics rendering shall use the WPF Integrated Renderer (DirectX) and Vortice.Windows for high-performance viewing.\nThe logging framework shall be Serilog.\n<<$Change>> The installation package shall be a signed MSIX Installer.\nEnhancement Justification: MSIX provides a modern, reliable, and clean installation and uninstallation experience on Windows 10/11. It simplifies updates and enhances security through containerization.\n\n--- Enhanced Specification ---\nThe application shall be built on the .NET 6+ Framework.\nThe application shall be written in C# 10+.\nThe desktop UI shall be built with WPF (Windows Presentation Foundation).\nThe UI shall use the MVVM (Model-View-ViewModel) design pattern.\nThe Windows Service shall be built using Microsoft.Extensions.Hosting.WindowsServices.\nInter-Process Communication between the UI and the Windows Service shall use Named Pipes for print job submission.\nThe database shall be PostgreSQL (version 13+).\nThe ORM shall be Entity Framework Core 6+.\nThe DICOM library shall be fo-dicom.\nAsynchronous task and data processing shall be managed via a message queue (RabbitMQ).\nGraphics rendering shall use the WPF Integrated Renderer (DirectX) and Vortice.Windows for high-performance viewing.\nThe logging framework shall be Serilog.\n<<$Change>> The installation package shall be a signed MSIX Installer.\nEnhancement Justification: MSIX provides a modern, reliable, and clean installation and uninstallation experience on Windows 10/11. It simplifies updates and enhances security through containerization.",
    "requirement_type": "technology",
    "priority": "",
    "original_text": "",
    "change_comments": false,
    "enhancement_justification": ""
  },
  {
    "id": 78,
    "section": "2.3 User Roles and Permissions",
    "section_id": "REQ-USR-001",
    "section_requirement_text": "The system shall enforce a role-based access control model with two distinct roles: Technician and Administrator.\nTechnician Role Permissions:\nThe system shall allow a Technician to view and search for studies.\nThe system shall allow a Technician to perform all viewing operations, including zoom, pan, and Window Width/Level (WW/WL).\nThe system shall allow a Technician to create and save annotations.\nThe system shall allow a Technician to use all print and export functions, including Print to Printer, PDF, and Email.\nThe system shall prevent a Technician from editing DICOM metadata.\nThe system shall prevent a Technician from changing system settings, including PACS, Users, and Storage Paths.\nThe system shall prevent a Technician from viewing audit trails.\nAdmin Role Permissions:\nThe system shall grant an Admin all permissions of the Technician role.\nThe system shall allow an Admin to edit DICOM metadata tags from a configurable list.\nThe system shall allow an Admin to manage user accounts and roles.\nThe system shall allow an Admin to configure all system, print, and network settings.\nThe system shall allow an Admin to view and export audit trails.",
    "requirement_type": "business",
    "priority": "",
    "original_text": "",
    "change_comments": false,
    "enhancement_justification": ""
  }
]